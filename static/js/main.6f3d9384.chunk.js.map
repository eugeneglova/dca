{"version":3,"sources":["functions.js","TableEdit.js","App.js","index.js"],"names":["getDecimals","value","absValue","Math","abs","precision","decimals","floor","getCost","p","a","getPositionPL","entryPrice","exitPrice","amount","fee","pl","exitFee","getPositionPLPercent","cost","positiveAmount","max","getPositionCost","getPosition","pp","pa","op","oa","getPosPrice","plp","id","_","uniqueId","price","getPercentPrice","percent","parseFloat","getNextPrice","xPrice","sign","index","log10","getNextAmount","xAmount","getLiqPrice","leverage","min_margin","getAvgPosition","orders","maxIndex","length","reduce","acc","order","isEmpty","getOrderColumns","rows","settings","name","title","getCellValue","row","indexOf","liq_price","prevPrice","diff","diffPercent","getOrderRows","entryAmount","pricePercent","endPrice","push","getOrders","orderRows","map","data","type","symbol","flags","String","meta","lev","undefined","aff_code","JSON","stringify","isPublic","throttle","payload","join","getBinanceFuturesOrders","quantity","timeInForce","side","stopPrice","workingType","positionSide","getRowId","FocusableCell","onClick","restProps","Cell","tabIndex","onFocus","TableEdit","initRows","columns","onChange","useState","setRows","editingCells","setEditingCells","useEffect","commitChanges","changedRows","added","changed","deleted","startingAddedId","deletedSet","Set","filter","has","onCommitChanges","onEditingCellsChange","addedRows","onAddedRowsChange","cellComponent","selectTextOnEditStart","showAddCommand","showDeleteCommand","App","xPositionAmount","log","setSettings","setOrderRows","pos","getPlRows","plRows","setPlRows","settingsColumns","parse","prompt","positions","position","status","basePrice","exitPirce","positionRows","pair","newOrderRows","all","slice","newOrderRowsSorted","orderBy","concat","exchange","console","copy","handleCopyOrders","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.6f3d9384.chunk.js","sourcesContent":["import _ from 'lodash'\n\nconst getDecimals = (value) => {\n  const absValue = Math.abs(value)\n  if (absValue < 0.0005) return 6\n  if (absValue < 0.005) return 5\n  if (absValue < 0.05) return 4\n  if (absValue < 0.5) return 3\n  if (absValue < 1) return 2\n  if (absValue < 1000) return 2\n  if (absValue < 10000) return 1\n  return 0\n}\n\nexport const precision = (value, decimals = getDecimals(value)) =>\n  Math.floor(value * 10 ** decimals) / 10 ** decimals\n\nconst getCost = (p, a) => precision(p * a)\nconst getPosPrice = (pp, pa, op, oa) => precision((getCost(pp, pa) + getCost(op, oa)) / (pa + oa))\n\nexport const getPositionPL = (entryPrice, exitPrice, amount, fee) => {\n  const pl = (exitPrice - entryPrice) * amount\n  const exitFee = exitPrice * Math.abs(amount) * fee\n  return precision(pl - exitFee)\n}\n\nconst getPositionCost = (entryPrice, exitPrice, amount) => {\n  const positiveAmount = Math.abs(amount)\n  if (amount < 0) {\n    return Math.max(positiveAmount * entryPrice, positiveAmount * exitPrice, 0)\n  }\n  return Math.max(positiveAmount * entryPrice, 0)\n}\n\nexport const getPositionPLPercent = (entryPrice, exitPrice, amount) => {\n  const pl = getPositionPL(entryPrice, exitPrice, amount, 0)\n  const cost = getPositionCost(entryPrice, exitPrice, amount)\n  return pl && cost !== 0 ? (pl / cost) * 100 : 0\n}\n\nexport const getPosition = (pp, pa, op, oa) => {\n  const p = getPosPrice(pp, pa, op, oa)\n  const a = precision(pa + oa)\n  const pl = getPositionPL(p, op, a, 0.002)\n  const plp = precision(getPositionPLPercent(p, op, a))\n  return {\n    id: _.uniqueId(),\n    price: p,\n    amount: a,\n    op,\n    oa,\n    pl,\n    plp,\n  }\n}\n\nexport const getPercentPrice = (entryPrice, percent) =>\n  precision(parseFloat(entryPrice) + parseFloat(entryPrice) * (parseFloat(percent) / 100))\nexport const getPricePercent = (price, entryPrice) =>\n  precision(((parseFloat(price) - parseFloat(entryPrice)) * 100) / parseFloat(entryPrice))\n\nconst getNextPrice = (price, xPrice, sign, index) => {\n  return precision(price + sign * price * xPrice * Math.log10((index + 2) * 1.3))\n  // return precision(price + sign * price * xPrice * Math.pow(index + 1, 1 / 3))\n}\nconst getNextAmount = (amount, xAmount, index) => precision(amount * xAmount)\n\nconst getLiqPrice = (price, amount, leverage, min_margin) => (\n  price * (1 + (1 / leverage - min_margin) * Math.sign(amount) * -1)\n)\n\nexport const getSettingsColumns = () => [\n  { name: 'symbol', title: 'Symbol' },\n  { name: 'entryPrice', title: 'Entry Price' },\n  { name: 'entryAmount', title: 'Entry Amount' },\n  { name: 'pricePercent', title: 'Price Percent' },\n  {\n    name: 'price',\n    title: 'Price',\n    getCellValue: (row) => getPercentPrice(row.entryPrice, row.pricePercent),\n  },\n  { name: 'xPrice', title: 'x Price' },\n  { name: 'xAmount', title: 'x Amount' },\n  { name: 'leverage', title: 'Leverage' },\n  { name: 'min_margin', title: 'Min Margin' },\n  { name: 'aff_code', title: 'Ref' },\n  { name: 'fee', title: 'Fee' },\n  { name: 'log', title: 'Log' },\n]\n\nexport const getAvgPosition = (orders, maxIndex = orders.length - 1) =>\n  orders.reduce((acc, order, index) => {\n    if (index > maxIndex) return acc\n    const { price, amount } = _.isEmpty(acc) ? { price: 0, amount: 0 } : acc\n    return getPosition(price, amount, parseFloat(order.op), parseFloat(order.oa))\n  }, {})\n\nexport const getOrderColumns = (rows, settings) => [\n  {\n    name: 'price',\n    title: 'Pos Price',\n    getCellValue: (row) => getAvgPosition(rows, rows.indexOf(row)).price,\n  },\n  {\n    name: 'liq_price',\n    title: 'Pos Liq Price',\n    getCellValue: (row) => {\n      const { price, amount } = getAvgPosition(rows, rows.indexOf(row))\n      const liq_price = getLiqPrice(price, amount, settings.leverage, settings.min_margin)\n      return precision(liq_price)\n    },\n  },\n  {\n    name: 'price diff',\n    title: 'Pos Price diff',\n    getCellValue: (row) => {\n      const prevPrice = getAvgPosition(rows, rows.indexOf(row) - 1).price\n      const diff = prevPrice - getAvgPosition(rows, rows.indexOf(row)).price\n      const diffPercent = (diff / prevPrice) * 100\n      return `${precision(diff || 0)} (${precision(diffPercent || 0, 2)}%)`\n    },\n  },\n  {\n    name: 'amount',\n    title: 'Pos Amount',\n    getCellValue: (row) => getAvgPosition(rows, rows.indexOf(row)).amount,\n  },\n  {\n    name: 'pc',\n    title: 'Pos Cost',\n    getCellValue: (row) => {\n      const { price, amount } = getAvgPosition(rows, rows.indexOf(row))\n      return getCost(price, amount)\n    },\n  },\n  { name: 'op', title: 'Ord Price' },\n  {\n    name: 'oliq_price',\n    title: 'Ord Liq Price',\n    getCellValue: (row) => {\n      const { op, oa } = getAvgPosition(rows, rows.indexOf(row))\n      const liq_price = getLiqPrice(op, oa, settings.leverage, settings.min_margin)\n      return precision(liq_price)\n    },\n  },\n  {\n    name: 'opp',\n    title: 'Ord Price diff',\n    getCellValue: (row) => {\n      const { op: prevPrice } = rows[rows.indexOf(row) - 1] || {}\n      const diff = prevPrice - row.op\n      const diffPercent = (diff / prevPrice) * 100\n      return `${precision(diff || 0)} (${precision(diffPercent || 0, 2)}%)`\n    },\n  },\n  { name: 'oa', title: 'Ord Amount' },\n  { name: 'oc', title: 'Ord Cost', getCellValue: (row) => getCost(row.op, row.oa) },\n  {\n    name: 'pl',\n    title: 'P/L',\n    getCellValue: (row) => {\n      const { pl, plp } = getAvgPosition(rows, rows.indexOf(row))\n      return `${precision(pl, 3)} (${precision(plp, 2)}%)`\n    },\n  },\n]\n\nexport const getOrderRows = ({\n  entryPrice = 6046.3,\n  entryAmount = 0.001,\n  pricePercent = -10,\n  xPrice = 0.009,\n  xAmount = 1.35,\n}) => {\n  const rows = []\n\n  let price = parseFloat(entryPrice)\n  let amount = parseFloat(entryAmount)\n  const sign = Math.sign(pricePercent)\n  const endPrice = getPercentPrice(parseFloat(entryPrice), parseFloat(pricePercent))\n  while (price * sign < sign * endPrice) {\n    rows.push({ id: _.uniqueId(), op: price, oa: amount })\n    const index = rows.length - 1\n    price = getNextPrice(price, xPrice, sign, index)\n    amount = getNextAmount(amount, xAmount, index)\n  }\n  return rows\n}\n\nexport const getPlColumns = () => [\n  { name: 'price', title: 'Pos Price' },\n  { name: 'amount', title: 'Pos Amount' },\n  { name: 'exitPrice', title: 'Exit Price' },\n  {\n    name: 'pl',\n    title: 'P/L',\n    getCellValue: (row) => {\n      const pl = getPositionPL(row.price, row.exitPrice, row.amount, 0.002)\n      const plp = getPositionPLPercent(row.price, row.exitPrice, row.amount)\n      return `${precision(pl, 3)} (${precision(plp, 2)}%)`\n    },\n  },\n]\n\nexport const getPlRows = (orderRows) => {\n  const pos = getAvgPosition(orderRows)\n  return [\n    { id: 'exit1', price: pos.price, amount: pos.amount, exitPrice: getPercentPrice(pos.price, 1) },\n    { id: 'exit2', price: pos.price, amount: pos.amount, exitPrice: getPercentPrice(pos.price, 2) },\n    { id: 'exit3', price: pos.price, amount: pos.amount, exitPrice: getPercentPrice(pos.price, 3) },\n  ]\n}\n\nexport const getOrders = (settings, orderRows) =>\n  orderRows\n    .map(({ op: price, oa: amount }) => {\n      const data = {\n        type: 'LIMIT',\n        symbol: settings.symbol,\n        flags: 0,\n        price: String(price),\n        amount: String(amount),\n        meta: {\n          lev: settings.leverage ? settings.leverage : undefined,\n          aff_code: settings.aff_code,\n        }\n      }\n      return (\n        `__dispatch(` +\n        JSON.stringify({\n          type: 'WS_REQUEST_SEND',\n          meta: { isPublic: false, throttle: true },\n          payload: JSON.stringify([0, 'on', null, data]),\n        }) +\n        `)`\n      )\n    })\n    .join('\\n')\n\nexport const getBinanceFuturesOrders = (settings, orderRows) =>\n  orderRows\n    .map(({ op: price, oa: amount }) => {\n      const payload = {\n        symbol: settings.symbol,\n        quantity: Math.abs(amount),\n        type: 'LIMIT',\n        timeInForce: 'GTC',\n        leverage: settings.leverage,\n        side: amount > 0 ? 'BUY' : 'SELL',\n        stopPrice: null,\n        workingType: null,\n        positionSide: amount > 0 ? 'LONG' : 'SHORT',\n        price: String(price),\n      }\n      return (\n        `__NEXT_REDUX_STORE__.dispatch(` +\n        JSON.stringify({\n          type: 'futuresOrderForm/placeOrder',\n          payload,\n        }) +\n        `)`\n      )\n    })\n    .join('\\n')\n","import React, { useState, useEffect } from 'react'\nimport { EditingState } from '@devexpress/dx-react-grid'\nimport {\n  Grid,\n  Table,\n  TableHeaderRow,\n  TableEditColumn,\n  TableInlineCellEditing,\n} from '@devexpress/dx-react-grid-material-ui'\n\nconst getRowId = row => row.id\n\nconst FocusableCell = ({ onClick, ...restProps }) => (\n  <Table.Cell {...restProps} tabIndex={0} onFocus={onClick} />\n)\n\nfunction TableEdit({ rows: initRows, columns, onChange = () => {} }) {\n  const [rows, setRows] = useState(initRows)\n  const [editingCells, setEditingCells] = useState([])\n\n  useEffect(() => {\n    setRows(initRows)\n  }, [initRows])\n\n  const commitChanges = ({ added, changed, deleted }) => {\n    let changedRows\n    if (added) {\n      const startingAddedId = rows.length > 0 ? rows[rows.length - 1].id + 1 : 0\n      changedRows = [\n        ...rows,\n        ...added.map((row, index) => ({\n          id: startingAddedId + index,\n          ...row,\n        })),\n      ]\n    }\n    if (changed) {\n      changedRows = rows.map(row => (changed[row.id] ? { ...row, ...changed[row.id] } : row))\n    }\n    if (deleted) {\n      const deletedSet = new Set(deleted)\n      changedRows = rows.filter(row => !deletedSet.has(row.id))\n    }\n    setRows(changedRows)\n    onChange(changedRows)\n  }\n\n  const addEmptyRow = () => commitChanges({ added: [{}] })\n\n  return (\n    <Grid rows={rows} columns={columns} getRowId={getRowId}>\n      <EditingState\n        onCommitChanges={commitChanges}\n        editingCells={editingCells}\n        onEditingCellsChange={setEditingCells}\n        addedRows={[]}\n        onAddedRowsChange={addEmptyRow}\n      />\n      <Table cellComponent={FocusableCell} />\n      <TableHeaderRow />\n      <TableInlineCellEditing selectTextOnEditStart />\n      <TableEditColumn showAddCommand showDeleteCommand />\n    </Grid>\n  )\n}\n\nexport default TableEdit\n","import React, { useState, useEffect } from 'react'\nimport copy from 'copy-to-clipboard'\nimport _ from 'lodash'\n\nimport {\n  getSettingsColumns,\n  getOrderColumns,\n  getOrderRows,\n  getPlColumns,\n  getPlRows,\n  getOrders,\n  getBinanceFuturesOrders,\n} from './functions'\nimport TableEdit from './TableEdit'\n\nfunction App() {\n  const [settings, setSettings] = useState({\n    id: 'settings',\n    symbol: 'tBTCF0:USTF0',\n    entryPrice: 9000,\n    entryAmount: 0.005,\n    pricePercent: -10,\n    xPrice: 0.011,\n    xPositionAmount: 0,\n    xAmount: 2,\n    leverage: 25,\n    min_margin: 0.005,\n    aff_code: 'Uv2r2svs8',\n    fee: 0.075,\n    log: 1,\n  })\n  const [orderRows, setOrderRows] = useState(getOrderRows(settings))\n  const [plRows, setPlRows] = useState(getPlRows(orderRows))\n\n  useEffect(() => {\n    setOrderRows(getOrderRows(settings))\n  }, [settings])\n\n  const settingsColumns = getSettingsColumns()\n\n  const handleCopyOrders = (exchange) => {\n    const getOrdersFnMap = {\n      'bitfinex': getOrders,\n      'binancefutures': getBinanceFuturesOrders,\n    }\n    const orders = getOrdersFnMap[exchange](settings, orderRows)\n    console.log(orders)\n    copy(orders)\n  }\n\n  return (\n    <div>\n      <center>\n        <h3>Settings</h3>\n      </center>\n      <TableEdit\n        rows={[settings]}\n        columns={settingsColumns}\n        onChange={rows => setSettings(rows[0])}\n      />\n      <center>\n        <h3>Positions / Orders</h3>\n      </center>\n      <button onClick={() => setOrderRows([])}>Clear positions / orders</button>\n      <button\n        onClick={() => {\n          const data = JSON.parse(prompt('copy(__state().data)'))\n          if (!data) return\n          const plRows = _.filter(\n            data.positions,\n            position => position.status === 'ACTIVE',\n          ).map(({ id, basePrice, amount }) => ({ id, price: basePrice, amount, exitPirce: basePrice }))\n          setPlRows(plRows)\n          const positionRows = _.filter(\n            data.positions,\n            position => position.pair === settings.symbol && position.status === 'ACTIVE',\n          ).map(({ id, basePrice, amount }) => ({ id, op: basePrice, oa: amount }))\n          const newOrderRows = _.filter(\n            data.orders.all,\n            order =>\n              order.symbol === settings.symbol.slice(1) &&\n              order.status === 'ACTIVE' &&\n              order.type === 'LIMIT' &&\n              Math.sign(order.amount) === Math.sign(settings.entryAmount),\n          ).map(({ id, price, amount }) => ({ id, op: price, oa: amount }))\n          const newOrderRowsSorted = _.orderBy(\n            newOrderRows,\n            ['op'],\n            [Math.sign(settings.entryAmount) < 0 ? 'asc' : 'desc'],\n          )\n          setOrderRows(positionRows.concat(newOrderRowsSorted))\n        }}\n      >\n        Import Data\n      </button>\n      <button onClick={() => handleCopyOrders('bitfinex')}>Copy Bitfinex orders</button>\n      {/* <button onClick={() => handleCopyOrders('binancefutures')}>Copy Binance Futures orders</button> */}\n      <TableEdit rows={orderRows} columns={getOrderColumns(orderRows, settings)} onChange={setOrderRows} />\n      <center>\n        <h3>Profit / Loss</h3>\n      </center>\n      <TableEdit rows={plRows} columns={getPlColumns()} onChange={setPlRows} />\n    </div>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n"],"sourceRoot":""}